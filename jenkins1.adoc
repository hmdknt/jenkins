= タイトル
Jenkinsの紹介



== 時間
.表
[cols="40,20,20,20",options="header"]

|===
| 項目 | 話す内容 | 図 | 時間 ｜ スライド
| 前提 | ○ | なし | 1m | ○
| CIって何？ | ○ | ○ | 2～3m | ○
| CIのメリット | ○ | ○ | 3m | ○
| CIで利用できるツールって何があるの？ | ○ | ○ | 1～2m | a
| Jenkins | ○ | なし | 1m | ○
| Jenkinの起動方法 | a | a | 1～2m | a
| Jenkinsのメリットって？ | ○ | ○ | 3m | a
| Git(タイトル考える) | ○ | a | 4m | a
| Jenkins2 | a | a | 5m | a
| プロジェクトの構成 | a | なし | 1～2m | a
| ビルドパイプラインの紹介 | a | ○ | 2m | a

|===



=== 前提
今回、Jenkinsについて紹介を行いたいと思いますが、現在のプロジェクトがJavaの開発を行っていることや +
JenkinsがJavaの開発で広く利用されていることから、今回はJavaの開発を前提としてJenkinsについて +
説明をさせていだだきます。 +
もちろんJenkinsはJavaだけでなく、Python、PHPといったJava以外の開発でも利用することができますが、 +
今回は説明を省かせていただきます。



=== CIって何？
Jenkinsについて説明をするまえにCIについて知っていただく必要があるため、まずはCIについて説明を行います。 +
皆さん、CIって何かご存知でしょうか？ +
CIとはContinuouts Integrationの略で、一般的には継続的インテグレーションと呼ばれています。 +
具体的には、開発者がGitやSVNなどのバージョン管理システムに対してソースコードの変更をコミットする度に、 +
スライドで示すようなビルドを自動的に行うことを指します。 +

image:reveal.js/images/build.png[]

ここでいうデプロイとは、静的解析の結果をSonarQubeのようなメトリクスツールに送信することや +
Nexusやartifactoryといったライブラリ管理ツールにアーティファクトを登録することを言います。 +



==== CIのメリット
CIのメリットとして、次のようなことが挙げられます。

* 機械的にビルドを実行するため、ビルドの工程をすべて網羅することが可能となり、開発者がローカル環境で見逃したコーディング +
規約違反やテストケース漏れを防ぐことができます
* 自動でビルドが実行されるため、稼働時間の短縮につながります
* バージョン管理システムに変更が適応される度にビルドを行い、ビルドが失敗したらビルドが成功するまで修正を繰り返すという +
  サイクルを継続的に回すため、バグの混入が少なくなり、工程が進んだ後の手戻りのリスクの削減や品質の維持につながります



=== CIで利用できるツールって何があるの？
先ほど説明したようなビルドを自動で実行するためのツールはいくつかありますが、ここではJenkins、CircleCI、TravisCIの3つの +
CIツールについて簡単に説明したいと思います。

image:reveal.js/images/compare_citools.png[]

この3つのCIツールを構築の面で見たときに、Jenkinsはオンプレミスなため利用するには、自らで構築を行う必要がありますが自ら構築 +
する分自由度は高いです。CircleCiとTravisCiに関してはSaasであり、自らで構築する必要がないためサービスに登録すればすぐに +
利用することができますが、自由度は低くなります。
GitHubと連携ができるかを見た時に、3つのツールともGithubと連携することが可能です。 +
WebUIで設定ができるかを見たたときに、JenkinsとCircleCIはWebUIで簡単に設定することが可能ですが、TravisCiに関しては、 +
yaml定義ファイルによって設定を行う必要があるため、設定したい内容をいファイルで書けるということが利用の条件になります。

情報を公開することに問題がないOSSや個人的な開発を行う上では、GitHubでバージョン管理し、circleciやTravis CIを利用し +
ビルドを行うことに問題はありません。しかし、情報を内部に閉じたい開発では、GitHubやcircleci、Travis CIといったSaaSは +
情報漏洩のリスクやセキュリティを自ら設定できないという点で利用しづらいです。そのため、情報を内部で閉じたい開発の場合は、 +
バージョン管理システムにはオンプレミスで構築可能なGitLabやGitBucketを利用しCIツールにはJenkinsを利用するといった形を +
取ることがあります。


=== Jenkins
JenkinsとはCIで説明したビルドを自動で行うためのツールである。

==== Jenkinの起動方法
ここでは、Jenkinsを利用するための前準備は完了している前提で起動方法について説明を行います。

jenkinsのホームページからjenkins.warをダウンロードします。java -jar jenkins.warで起動可能です。 +
あとは、http://localhost:8080にアクセスすればJenkinsを利用することができます。

また、tomcatのwebappsディレクトリにjenkins.warを配置し、tomcatを起動することでもJenkinsを利用することが可能です。

docker

==== Jenkinsのメリットって？
Jenkinsを利用するメリットはいくつかあります。 +

** 集合知がある +
Jenkinsには多くのプラグインが存在し、用途によって使用するプラグインを選択し自由にカスタマイズできるため汎用性が高いです。 +
また、書籍も出版されておりネットにも多くの情報が転がっているため、設定方法やエラー事象の解決方法を発見できる可能性が高いです。

** GUIで設定可能 +
Jenkinsのタスクを実行するための設定(ジョブ)はGUIベースで行うことができ、誰でも簡単に設定することができます。 +
項目についての説明は省かせていただきますが、基本的には、設定したいものにチェックを入れ、チェックを入れると出てくる項目に +
設定内容を追加することで処理が適応されます。　+
image:reveal.js/images/settings1.png[]
image:reveal.js/images/settings2.png[]

** 定期実行可能 +
JenkinsはCronによってビルドの実行時間を設定することができます。これにより、毎日定期的に行うビルドに関しては、人の手で +
行う必要がなくなるため、ビルド忘れの防止や稼働時間の削減につながります。
image:reveal.js/images/execute_time.png[]

** WebHookの設定が可能 +
WebHookとは、簡単に説明するとAというアプリとBというアプリがあったときに、Aのアプリでイベントが発生したときに、Bのアプリに +
イベントが発生したことをリアルタイムで通知するようなことを言います。
image:reveal.js/images/webhook.png[]

Jenkinsは、このWebHookの仕組みを利用することで、バージョン管理システムに対して変更が適応される度に、自動でビルドを実行
することが可能になります。


=== Git使ってますか？

先ほどGitについて少し話をしたので、急ではありますがここでGitについて説明したいと思います。 +
皆さん、そもそもGit利用していますか？ +
まだ、バージョン管理システムにSVNを利用していませんか？バージョン管理システムと言えば今はGitです。 +
image:reveal.js/images/statics.png[]

参考資料：https://blogs.oracle.com/ouchina/2016java

ZeroTurnaround社が2016年に公表した資料の中のバージョン管理システムの利用率を示したグラフをご覧ください。 +
2016年時点のGitの利用率は68%と全体の3分の2を占めており、バージョン管理システムにSVNではなくGitが広く +
使われていることが分かると思います。　+

なぜ、ソースコード管理システムにGitが多く使われているのでしょうか？ +

まずは、簡単にSVNについて少し説明します。SVNの基本的な構成はtrunk、branch、tagの3つになります。 +
基本的には、trunkに対して変更内容をコミットしながら開発を進め、リリースやバージョンが変わるときにbranchにコミットし、trunkのある状態 +
を残したいときはtagにコミットを行います。 +
このSVNの悪いと思う点をいくつか挙げたいと思います。 +
* バグの有無に関わらず、変更内容をコミットした時点で変更内容が取り込まれてしまう点
* レビューをするのに管理簿が必要
* 

バグの有無に関わらず、変更内容をコミットした時点で変更内容が取り込まれてしまう点についてですが、バグを含んだ変更内容をtrunkにコミット +
した場合、他の開発者がバグを含んだ状態のtrunkに更新して開発を進めていく可能性があります。そのため、混入したバグが原因でビルドがうまくいかないなど +
開発者の開発が止まるといったことが考えられます。バグが混入したコミットの度にこのような状態に陥る可能性があり、人数が多いと影響範囲を制限することが +
難しいため、SVNは人数の多い開発には向かないと思われます。

次に、レビューをするのに管理簿が必要についてですが、SVNではレビューを管理するには管理簿を用意する必要があります。そのため、レビューをしてもらう場合、 +
管理簿に変更内容と変更箇所を書き、レビュアーはその管理簿を見てレビューを行います。一見問題なさそうに見えますが、レビュアーは管理簿とソースコードの2つを +
行き来する必要があるため、レビューのスピードと精度が下がってしまします。また、レビュー中に誰かがレビュー対象のソースコードを更新すると、管理簿とソースコード間の +
情報が異なってしまうため、修正箇所を再度確認し、管理簿を修正する必要があるなど、コミット1つで無駄なやり取りが発生する可能性があるのもSVNの悪い点だと思います。


Gitは先ほど説明したSVNの悪いと思う点を解消できている点から、バージョン管理システムで最も使われていると思います。 +
GitはSVNとは違い、開発者は作業用にブランチを作成し、そのブランチで各自開発を行い、最終的に対象のブランチにマージを行います。そのため、コミット(gitだとpush)を行っても +
他の開発者の開発に影響を与えることなく開発を行うことができます。どのようにブランチを作成するか等はプロジェクトによって異なりますが、以下のようなgit-flowやgithub-flowと +
いったブランチ戦略が世の中には存在します。

image:reveal.js/images/git-flow.png[]

image:reveal.js/images/github-flow.png[]

また、gitには、githubやgitlabといったホスティングサービスがあります。これの大きな利点としては、レビュー時(Pull Request、Merge Request)にソースコードの差分を見ることができ、 +
変更箇所にシンタックスハイライトも付くため、変更箇所と変更内容の把握が容易になり、レビュアーのレビューの負担を減らすことができます。また、Gitが管理簿の役割を果たすため、管理簿と +
ソースコードとのファイルの行き来がなくなり、コメントもGit上に残すことができるため、効率よくレビューを行うことができます。

ただ、Gitには、SVNよりも操作が複雑なため学習コストが高いこととブランチを切る単位が人によって違うとコンフリクトが多発してしまうなどといったデメリットともあります。

=== Jenkins2.0

先ほど、Jenkinsのメリットについて説明しましたが、先ほどの説明はJenkins1の情報であり、Jenkins1を利用したことがある方はご存知の方も多かったではないでしょうか？ +
今からは、2016年4月20にアップデートされたJenkins2についての説明を行いたいと思います。
Jenkins1とJenkins2で大きく変わった点としては、Jenkinsfileの追加です。

* Jenkinsfileの追加
Jenkinsfileとは、Groovyで書くことができるDSLのことである。Jenkinsfileのメリットとしては以下のようなことが挙げられます。

** 設定ミスや設定漏れをなくすことができる
Jenkins1では、ジョブを作成するたびにGUIの設定を人間の手で1からする必要があったため、設定ミスや設定漏れを起こす可能性がありました。また、レビューをするにもGUIの項目を1つ1つ確認する必要があり、 +
変更点の差分も見ることができなかったため、レビュー1つ行うのも手間がかかりました。しかし、Jenkinsfileの登場により、ファイルによってジョブの定義を行うことが可能となり、同一の設定をする場合などは、 +
同じファイルを利用することで、 設定ミスや設定漏れをなくすことができます。

** Gitを使ったレビューを行うことができため、変更の管理がしやすくなった
ジョブの定義をファイルで行うことができるようになったことにより、ソースコードと一緒にGitで設定を管理することが可能になりました。Gitで管理する　+
ことによって、コードの差分に対してレビューを行うことができるため、変更内容と変更履歴の管理を容易に行うことができます。

** Gitとの相性が良くなった
JenkinsのMultibranchpipelineのジョブを作成することで、Gitのプロジェクトにあるすべてのブランチに対するジョブを自動で作成してくれるため、Jenkinsfileをmasterに持たせておけば、 +
作成するブランチは、Jenkinsfileを持った状態になりジョブの設定をすることなく、ビルドを行うことができます。


デメリットとしては、Jenkinsfile(DSL)が書けるということは、Groovyのソースの読み書きができることを意味するため、Groovyを覚える必要があることです。また、Groovyの読み書きができる人でないと　+
設定を行うことができないため、属人性が生まれてしまう可能性があるということがデメリットとなります。 +


